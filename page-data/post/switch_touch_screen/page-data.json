{"componentChunkName":"component---src-templates-post-js","path":"/post/switch_touch_screen/","result":{"pageContext":{"post":{"title":"タッチスクリーンの有効/無効切り替えのショートカットをつくる","image":{"file":{"url":"//images.ctfassets.net/nxx3igvspvb5/xNPwyyZGYjFy7OzWFjiTM/e5a43779788bd3305a842c510ac179ad/image.png"}},"body":{"childMarkdownRemark":{"html":"<p>私は画面タッチ機能を搭載しているPCを使っているのですが、持ち運び時やペン使用時などに手が反応してしまい予期しない動きをしてしまうことがあります。これの対処を行うために画面タッチ機能をワンタップでON/OFFするものをつくりました。</p>\n<h3>概要</h3>\n<p>PCのタッチスクリーンをワンタップでONOFFするbatファイルの作成</p>\n<h3>動作環境</h3>\n<ul>\n<li>OS : windows11</li>\n<li>PC : ENVY x360 Convertible</li>\n<li>アカウント : 管理者user</li>\n<li>ディレクトリ構成(必要な部分のみ)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">C:\n│ \n～\n├──devcon.exe\n├──touch_switch.bat\n└──touch_switch.bat.lnk</code></pre></div>\n<h3>前準備</h3>\n<p>devconのインストール</p>\n<h3>処理フロー</h3>\n<ul>\n<li>devconにてタッチデバイスの有効or無効を取得する。</li>\n<li>有効なら無効化、無効なら有効化</li>\n</ul>\n<h3>devconの動作</h3>\n<p>devconは簡単に言えばデバイスをいじいじするもので、詳細な説明は<a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/devtest/devcon-general-commands\">ここ</a>に書かれてあります。今回使用するのはdevcon statusコマンドとdevcon enable/disableコマンドです</p>\n<ul>\n<li>devcon status \"device_id\"</li>\n</ul>\n<p>このコマンドはdevice_idで指定したidのデバイスの状態を返します。\n以下に出力例を示します。(実際はdevice_idを実際のIDに置換された状態で出力されます。)\n例</p>\n<ul>\n<li>デバイス有効時</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">device_id\n    Name: HID     Driver is running.\n1 matching device(s) found.</code></pre></div>\n<ul>\n<li>デバイス無効時</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">device_id\n Name: HID     Device is disabled.\n1 matching device(s) found.</code></pre></div>\n<ul>\n<li>devcon enable / disable \"device_id\"</li>\n</ul>\n<p>このコマンドはデバイスの有効化・無効化を行うコマンドです。管理者権限の下で動作します。</p>\n<h3>device_idの確認</h3>\n<p>デバイスマネージャーを開きHIDデバイスの中に\"HID準拠タッチスクリーン\"(環境によって差異があると思われる)というものがあるので、右クリックしプロパティを開きます。\n詳細のタブからハードウェアIDを選択し、表示されたものがdevice_idを置換する文字列となります。\n<img src=\"//images.ctfassets.net/nxx3igvspvb5/mM4EGQbM1fr9gHAGD13cJ/912529e85ad5bf9f1148486ba22e4416/image.png\" alt=\"device_id説明\"></p>\n<h3>実装</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@echo off\n\ncd %~dp0\n\ndevcon status \"device_id\"|findstr \"running.\" \n\nIF %ERRORLEVEL%==0 (\n\tdevcon disable \"device_id\"\n) ELSE (\n\tdevcon enable \"device_id\"\n)\n</code></pre></div>\n<p>まず最初に@echo offで余計な出力をOFFにし、cd %~dp0でカレントディレクトリをバッチファイルが存在するディレクトリに設定します。\n次にdevcon stausを実行し、パイプでfindstrに実行結果を渡します。\nこれによりdevcon statusの実行結果内に\"running\"という語が含まれているかを検出します。\nfindstrはファイルから文字を検索するコマンドで、見つかった場合0を、見つからなかった場合1を、%ERRORLEVEL%に返します。</p>\n<p>次に%ERRORLEVEL%の値で場合分けをします。\n%ERRORLEVEL%が0、すなわちrunningという語が見つかった場合、デバイスのdisable処理を行います。\n%ERRORLEVEL%が1の場合はデバイスのenable処理を行います。</p>\n<p>この内容を拡張子.bat、文字コードANSIとし、devconコマンドが動作するディレクトリに保存します。</p>\n<h3>起動の設定</h3>\n<p>先ほどのdevicon enable/disableの部分でこれらのコマンドは管理者権限の下でしか動作しないと説明しました。しかし、管理者権限で起動するには確認のダイアログが出てきて、許可をしないといけません。なのでダイアログの表示をスキップさせます。(これらは本来確認すべきプロセスを飛ばしているので推奨できるかと言われると首を縦には振れません。この設定はあくまで自己責任でお願いします。)</p>\n<ol>\n<li>タスクスケジューラへの設定</li>\n</ol>\n<p>検索等から「タスクスケジューラ」を探し、起動します。\n操作タブの「タスクの作成」をクリックして以下のようなウィンドウを表示させます。\n<img src=\"//images.ctfassets.net/nxx3igvspvb5/38g3NNObPTdpol8Ukjz31K/9cf2d78f5c019ce444fe5354e4492e69/image.png\" alt=\"タスクの作成ウィンドウ\">\n条件タブから「コンピューターをAC電源で～」のチェックを外します(optional)。\n操作タブの左下「新規」ボタンを押し、「プログラム/スクリプト」欄に実行するバッチファイルのパス、「開始(オプション)」欄に実行するバッチファイルのディレクトリを入力します。\n今回の構成での例 :\n<img src=\"//images.ctfassets.net/nxx3igvspvb5/7rmGLPFuQopt8zfHy8jYWt/8973a6e009c9e53f879ee6ff618021d4/image.png\" alt=\"touch_switch タスク\">\n最後に全般タブにて「最上位の特権で実行する」にチェックを入れ、タスクを任意の名称で保存します(この時設定したタスク名は控えておいてください)。</p>\n<ol start=\"2\">\n<li>ショートカットの作成</li>\n</ol>\n<p>先ほどと作成したバッチファイルと同じディレクトリにショートカットを作成し、参照先を「C:\\Windows\\System32\\schtasks.exe /run /tn \"さっき設定したタスク名\"」とします。これによって先ほど設定したタスクをショートカットで呼び出しています。あとはこれを起動しやすい場所にショートカットなりピン止めなりして完成です。(私はタスクバーにピン止めしています)</p>"}},"updatedAt":"2022年12月26日","description":{"description":"タッチスクリーンの切り替えバッチファイルの作成"},"slug":"switch_touch_screen"}}},"staticQueryHashes":["2841359383","3257411868","426988268"],"slicesMap":{}}