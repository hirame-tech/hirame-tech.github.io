{"componentChunkName":"component---src-templates-post-js","path":"/post/esp-idf-esp32-psram-timer-camera-x/","result":{"pageContext":{"post":{"title":"esp-idfでESP32 PSRAM Timer Camera Xを使う","image":{"file":{"url":"//images.ctfassets.net/nxx3igvspvb5/76vEM0BHHD0aPq1qSD0vog/456c948329544a35d4f8a0bbede34f2b/PXL_20230417_152137579.jpg"}},"body":{"childMarkdownRemark":{"html":"<p><a href=\"https://www.switch-science.com/catalog/6742/\">これ</a>を使う機会があり、使いやすかったので私用に購入し3dプリンタ監視用に使おうと思ったので作業メモ。</p>\n<h2>プログラムを書きこむ</h2>\n<p>プロジェクトをesp32をターゲットに設定し、</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">idf.py <span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">[</span>COMポート<span class=\"token punctuation\">]</span> <span class=\"token parameter variable\">-b</span> <span class=\"token number\">150000</span></code></pre></div>\n<p>を実行する(COMポートはデバイスマネージャー等で調べておく)</p>\n<h2>Cameraを使いたい</h2>\n<p>今回はESP32 Camera Driverを使用する。\n今回組んだものは<a href=\"https://github.com/hirame-tech/Timer_Camera_X_test/tree/master/TimerX_cam_test\">これ</a>\ncomponents以下に移動して</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/espressif/esp32-camera</code></pre></div>\n<p>を実行する。正常にcloneされたらmenuconfigを開き、\nComponent config>Camera configuration>Support OV3660にチェックが入っていることを確認する。</p>\n<ul>\n<li>出たエラーとその対処</li>\n<li>その1</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">E (802) cam_hal: cam_dma_config(293): frame buffer malloc failed\nE (812) cam_hal: cam_config(377): cam_dma_config failed\nE (812) camera: Camera config failed with error 0xffffffff\nE (822) example:take_picture: Camera Init Failed</code></pre></div>\n<ul>\n<li>原因 : PSRAMが有効になっていない？</li>\n<li>やったこと：</li>\n</ul>\n<p>Component config > ESP32-specific > Support for external, SPI-connected RAMを有効にする</p>\n<ul>\n<li>結果：success!</li>\n</ul>\n<h2>PSRAMを使いたい</h2>\n<p>Cameraを使うということはそれなりの処理を行うということで、その結果の格納、また処理過程において配列に画像を保存しておかなければならない。この時にPSRAMに配列を確保できればいいなぁ、と。\n上でやったように、\nComponent config > ESP32-specific > Support for external, SPI-connected RAMを有効にし、その下のSPI RAM configのSPI RAM access method >  Make RAM allocatable using heap_caps_mallocを有効にする。これによりmalloc()関数でPSRAMを使用することができる(注:4MiBしか使えないので8MiB使いたい場合などには<a href=\"https://github.com/espressif/esp-idf/tree/c77c4ccf6c43ab09fd89e7c907bf5cf2a3499e3b/examples/system/himem\">ここ</a>を参照)</p>"}},"createdAt":"2023年04月17日","description":{"description":"esp-idfでのカメラとPSRAMの有効化"},"metadata":{"tags":[{"contentful_id":"arduino","name":"Arduino"},{"contentful_id":"windows","name":"windows"}]},"slug":"esp-idf-esp32-psram-timer-camera-x"}}},"staticQueryHashes":["2841359383","426988268"],"slicesMap":{}}